<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<link REL="SHORTCUT ICON" HREF="img/favicon.ico">
		<title>Teaching Moves</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="lib/papaparse.min.js"></script>
	</head>
	<style>
		 body { 			font-family:Segoe UI,Verdana,Geneva,sans-serif; font-size:16px; box-sizing:border-box; 
							padding:0; margin:0; position:fixed; width:100%; 
							}
		.lz-splash { 		color:#999; text-align:center; margin-top:10%; display:none;
							}
		.lz-main { 			width:100%; height:var(--maxvh); display:none;
							}
		.lz-if { 			position:absolute; top:90px; left:calc(12.5% + 24px); font-size:28px; font-weight:normal; width:70%
							}
		.lz-infield { 		position:absolute; top:150px; left:calc(12.5% + 24px); text-align:left;
							}
		.lz-flow { 			position:absolute; display:table; top:0; left:0; height:100%; width:calc(12.5% ); 
							text-align:right;
							}
		.lz-dialog {		position:absolute; top:16px; left:16px; background-color: #eee; border: 1px solid #aaa;
							padding:16px; border-radius: 16px; width: 600px;
							}
		.lz-confirm {		position:absolute;  width:300px; padding: 16px; left:calc(50% - 150px); top:calc(50vh - 50px); user-select: none;	
							border-radius: 8px; background-color: #fff; border: 1px solid #999; box-shadow: 4px 2px 12px 2px #aaa; 
							}
		.lz-popup {			position:absolute;  width: auto; max-width:200px; padding: 12px; left: calc(50% - 100px); top: calc(66% - 50px);
							border-radius: 8px; background-color: #eee; border: 1px solid #999; box-shadow: 4px 2px 12px 2px #aaa; 
							font-size: 14px; text-align:center; display: none;
			}
		.lz-is {			border-radius:16px; padding:0 8px; width:250px; height: 24px;
							border:1px solid #999; font-size: 13px;
							}
		.lz-bs {			cursor: pointer; color:#fff; text-align: center; border-radius: 16px; display: inline-block;
							font-size: 16px; background-color: #27ae60; padding: 4px 12px 4px 12px; vertical-align:3px;user-select: none;
							} 

		:root  {			--maxvh: 100vh  }
		table  {			border-spacing: 0px;  }

		body ::-webkit-scrollbar { width: 9px; height:8px } 
		body ::-webkit-scrollbar-track { background: transparent; }
		body ::-webkit-scrollbar-thumb { border-radius:8px ;background:#a4baec }
		body ::-webkit-scrollbar-thumb:hover { background: #a4baec }

</style>
	<body>
		<div class="lz-main" id="mainDiv">
			<svg id="lz-trackSVG" width="100%" height="100%" style="position:absolute;left:0;top:0"></svg>
			<div id="lz-flowDiv" class="lz-flow"></div>
			<div id="lz-ifDiv" class="lz-if"></div>
			<div id="lz-infieldDiv" class="lz-infield"></div>
			<img src="img/smlogo.png" style="position:absolute;left:93%; top:18px;width:4%">
		</div>
			<div id="splashDiv" class="lz-splash">
			<img src="img/ACTlogo.png" style='width:200px' alt="logo"><br>
			<br><p style="color:#000;font-size:14px"><em>A game to practice teaching techniques</em></p>
			<br><p style="color:#000;font-size:14px"><b>Please type in your first name below</b></p>
			<p></p><input class='lz-is'  type='text' id='lz-login'></p>
			<br><br><br><br><div style="font-size:11px">&copy; 2022 StageTools </div>
		</div>
	
<script>

/////////////////////////////////////////////////////////////////////////////////////////////////
// MAIN 
/////////////////////////////////////////////////////////////////////////////////////////////////

	var app=null;																					// Holds app
	var isMobile=false;																				// Mobile?
	var noNode=true;																				// No node js?

let test=0;

	$(document).ready(function() {								           							// ON PAGE LOADED
		app=new App();																				// Load app
		if (window.location.host != "localhost") 													// Not in debug
			$("#splashDiv").fadeIn(2000);															// Fade in splash page
		else{																						// Debug
			$("#mainDiv").fadeIn(0);																// Load fast
			app.LoadConfig();																		// Load config to start round	
			}
	
		$("#lz-login").on("change",()=> { 															// ON LOG IN
			app.playerId=$("#lz-login").val().trim();												// Set player id
			$("#splashDiv").fadeOut();																// Fade out splash
			$("#mainDiv").fadeIn(2000);																// Fade in main
			app.LoadConfig();																		// Load config to start round	
			});

		$(window).on("keydown",function(e) {														// HANDLE KEYPRESS
			if ((e.which == 81) && e.ctrlKey)	{													// Test key (CTL-Q)
				}
			});
	});

	$(window).on("resize orientationchange", ()=>{                                       		 // ON WINDOW RESIZE
		document.documentElement.style.setProperty("--maxvh", window.innerHeight+"px");				// Set CSS var for IOS 100vh isssue
		app.Draw();																					// Redraw to fit screen
		let hgt=$(window).width()*.5625*app.vidSize/100;											// Height
		let top=($(window).height()-hgt)/2;															// Top
		$("#lz-videoChat").css({width:app.vidSize+"%",height:hgt+"px",top:top+"px"});				// Resize video if open
		});

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// APP
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

class App  {																					

	constructor()   																				// CONSTRUCTOR
	{
		app=this;
		this.sessionId="1";																				// Session id
		this.playerId="bill@192.168.1.1";																// Player id
		this.ifs=[];																					// Holds ifs
		this.players=[];																				// Game players
		this.thens=[];																					// Holds thens
		this.strings=[];																				// Holds strings
		this.flow=[];																					// Holds flow
		this.vidSize=70;																				// Width of video screen
		this.stuPos=[];																					// Student track positions
		this.stuCols=["#b0263e","#256caa","#ea7f1d","#9c25aa","#25aa54"]								// Student colors
		this.curIf="";																					// Current if
		this.curPhase=0;																				// Current phase
		this.InitSocketServer();																		// Start socket server
	}

	LoadConfig()																					// LOAD CONFIG FILE
	{	
		let i;
		fetch('data/config.csv')																		// Load file
			.then(res => res.text())																	// Get as text
			.then(res =>{																				// Process																	
				let d=Papa.parse(res, { header:true, skipEmptyLines:true }).data;						// Parse CSV using papa lib
				for (i=0;i<d.length;++i) {																// For each line
					if (d[i].type == "if")				this.ifs.push(d[i].title);						// Add if
					else if (d[i].type == "then")		this.thens.push(d[i]);							// Add then											
					else if (d[i].type == "string")		this.strings[d[i].category]=d[i].title;			// Add string										
					else if (d[i].type == "phase")		this.flow.push(d[i]);							// Add flow										
					}
				this.players[0]=this.playerId;															// Add me
	this.players[1]="Sara@1";	this.players[2]="Kim@2";	this.players[3]="Sasha@3";
				$("#lz-infieldDiv").html(this.strings["help"]);											// Start with help
				this.Draw();																			// Draw screen
			})
	}

	StartRound()																					// START A NEW ROUND
	{
		let r=Math.floor(Math.random()*this.ifs.length);												// Random number
		this.curIf=this.ifs[r];																			// Get an if
		this.ifs.splice(r,1);																			// Remove it
	}

/////////////////////////////////////////////////////////////////////////////////////////////////
// DRAW 
/////////////////////////////////////////////////////////////////////////////////////////////////

	Draw()
	{
		$("#lz-ifDiv").html(this.curIf ? "<b><i>IF... </i></b>"+this.curIf : "");						// Show if
		this.DrawTrack(this.stuPos);																	// Draw track
		this.DrawFlow();																				// Draw phase flow chart
		this.DrawClock(22);																				// Draw clock
	}

	VideoChat(pct)																				// OPEN VIDEO CHAT
	{
		app.vidSize=pct;																				// Save width in case of resize
		$("#lz-videoChat").remove(); 																	// Remove old one
		if (!pct)	return;																				// Quit if no size
		let hgt=$(window).width()*.5625*pct/100;														// Set height
		let top=($(window).height()-hgt)/2;																// Width
		let link="japp.htm?AgileGameChat~Session~"+app.sessionId;										// Make link
		let str=`<div id="lz-videoChat" style="position:absolute;background-color:#999;
			width:${pct}%;height:${hgt}px;top:${top}px;left:250px;display:none">
			<iframe style="width:100%;height:100%" src="${link}" 
			allow=camera;microphone;autoplay frameborder="0" allowfullscreen>
			</iframe>`;
		$("body").append(str.replace(/\t|\n|\r/g,""));													// Add it
		$("#lz-videoChat").show("slide",{ direction:"up" },1000);										// Slide down 
	}

	DrawTrack(pos)																					// DRAW STUDENT TRACK	
	{
		let i,sw=8;
		let left=$(window).width()/8+24;
		let bend=($(window).height()-48)*.3333;															// Corner size
		let w=($(window).width()-left-24-bend)															// Straight-away
		let bh=this.stuCols.length*(sw+2);																// Band height
		let str=`<text x="${w/2+left}" y="${24+bh+12}" letter-spacing="8" text-anchor="middle" fill="#666" font-size="16">LEARNING</text>`;								
		str+=`<text x="${w+bend+left-bh-12}" y="${$(window).height()/2}" text-anchor="middle" style="writing-mode: tb;text-orientation:upright" fill="#666" font-size="16">THRIVING</text>`;						
		str+=`<text x="${w/2+left-8}" y="${$(window).height()-24-bh}" letter-spacing="8" text-anchor="middle" fill="#666" font-size="16">LIBERATING</text>`;						

		for (i=0;i<this.stuCols.length;++i) str+=drawBand(i,"#cccccc", 10);								// Gray base
		for (i=0;i<this.stuCols.length;++i) str+=drawBand(i,this.stuCols[i],i);							// Colored rings
		$("#lz-trackSVG").html(str);																	// Set SVG
		
		function drawBand(num, col, step) {																// DRAW STUDENT BAND
step=step+4;
			bh=(num*(sw+2));																		// Line offset
			let y=24+bh;																				// Y pos
			let x=w/5*Math.min(step,5);																	// Position in straight-away
			let s=`<path style="fill:none;stroke:${col};stroke-width:${sw};
				stroke-linecap:round;stroke-linejoin:round"	d="M ${left} ${y} `;						// Start line
				s+=`L ${x+left} ${y} `;																	// Add straight-away
				if (step > 5)	s+=` a ${bend-bh} ${bend-bh} 0 0 1 ${bend-bh} ${bend-bh} `;				// Top curve
				if (step > 6)	s+=` l 0 ${bend} `;														// Middle 
				if (step > 7)	s+=` a ${-bend+bh} ${-bend+bh} 0 0 1 ${-bend+bh} ${bend-bh} `;			// Bottom curve
				if (step > 8)	s+=` l ${-w/2} 0 `;														// Add last leg 1
				if (step > 9)	s+=` l ${-w/2} 0 `;														// Add last leg 1
				s+=`"/>`;																				// Close line
				return s;																				// Close path and return band
			}
	}

	DrawHourGlass(pct, time=60)																		// DRAW HOURGLASS
	{
		$("#lz-hourGlass").remove();																	// Remove old one
		let wid=50;																						// Set width
		let hgt=wid*3;																					// Set hgt
		let	x=$(window).width()-160;																	// X pos
		let y=$(window).height()/2-hgt/2;																// Y
		let str=`<div id="lz-hourGlass" style="position:absolute;overflow:hidden;
			width:${wid}px;height:${hgt}px;left:${x}px;top:${y}px">
			<img src="img/sandtop.png" style="position:absolute;width:100%;height:100%;top:${hgt*pct/200}px">
			<img src="img/hourtop.png" style="position:absolute;width:100%;height:100%">
			<img src="img/sandbot.png" style="position:absolute;width:100%;height:100%;top:${hgt*(100-pct)/200}px">
			<img src="img/hourglass.png" style="position:absolute;width:100%;height:100%"></div>`;
			$("body").append(str); 																		// Add to body
	}

	DrawClock(mins, tot=45)																			// DRAW CLOCK
	{
		let i,x1,y1,col;
		let rad=$(window).height()/20;																	// Radius based on height
		let x=$(window).width()-rad-rad-20;																// X pos
		let y=$(window).height()-rad-rad-20;															// Y
		let step=(2*Math.PI)/tot;																		// Dot step
		let ang=-Math.PI/2;																				// Start straight up
		$("#lz-clockSVG").remove();																		// Remove old one
		let str=`<svg id="lz-clockSVG" width="100%" height="100%" style="position:absolute;left:${x}px;top:${y}px">`;
		for	(i=0;i<tot;++i) {																			// For each mark
			x1= rad+4+rad*Math.cos(ang);																// Calc x
			y1= rad+4+rad*Math.sin(ang);																// Y
			ang+=step;																					// Next angle
			col=(i < mins) ? "#25aa54" : "#cccccc";														// Set color
			str+=`<circle cx="${x1}" cy="${y1}" r="3" fill="${col}" />`;								// Draw dot
			}
		str+=`<text x="${rad+3}" y="${rad*1.3}" text-anchor="middle" fill="#666" font-size="${rad}">${i}</text>`;	// Number						
		str+=`<text x="${rad+3}" y="${rad*1.6}" text-anchor="middle" fill="#666" font-size="${rad/4}">minutes</text></svg>`; // Label						
		$("#mainDiv").append(str); 
	}

	DrawFlow()																						// DRAW PHASE FLOW CHART
	{
		let i=1,j;
		let fh=Math.max($(window).width()/120,13);
		let y=$(window).height()-59;
		let str=`<div class="lz-bs" id="lz-botbut" style="font-size:${fh}px;background-color:#ccc;position:absolute;top:${y}px;right:0">NEXT ROUND</div>`;
		str+=`<div style="height:100%; width:100%;">
		<div class="lz-bs" id="lz-topbut" style="font-size:${fh}px;background-color:${(this.curPhase == 0) ? "#27ae60" : "#ccc"};margin-top:30px">START THE GAME!</div><br><br>`;		
		str+=addItem(i++,"DISCUSS IF...")																// Add IF phase
		str+=addItem(i++,"DEAL CARDS")																	// DEAL
		for (j=0;j<this.players.length;++j)																// For player	
			str+=addItem(i++,this.players[j].split("@")[0]+" TALKS");									// Add player's name
		str+=addItem(i++,"VOTE")																		// VOTE
		str+=addItem(i++,"DISCUSS")																		// DISCUSS
		$("#lz-flowDiv").html(str);																		// Add flowchart

		$("#lz-topbut").on("click", ()=>{ this.SetPhase(1); });											// ON START CLICK
		$("#lz-botbut").on("click", ()=>{ this.SetPhase(1); });											// ON NEXT CLICK

		$("[id^=lz-phase-]").on("click", (e)=>{	this.SetPhase(e.target.id.substring(9)-0) });	// ON ITEM CLICK 
		function addItem(num, name) {
			let col=(num == app.curPhase) ? "#27ae60" : "#ccc";											// Hilite curPhase
			let s=`<p><div class="lz-bs" id="lz-phase-${num}" style="font-size:${fh}px;background-color:${col}">${name.toUpperCase()}</div></p>`;
			return s;																					// Return item markup
			}
	}

	SetPhase(phase)																					// SET PHASE OF GAME
	{
		if (phase == 1) {																				// START 
			if (this.curPhase != 0)	return;																// Only at beginning		
	//		this.VideoChat(66);																			// Open video chat	
			Sound("ding");																				// Ding
			this.StartRound();																			// Start round													
			this.DrawHourGlass(66,5);																	// Show hour glass 
			$("#lz-infieldDiv").html("");																// Clear infield	
			}
		else if (phase == 2) {																			// DEAL 
//			if (this.curPhase != 1)	return;																// Only at beginning		
			this.DealCards();																			// Deal cards
			}
		this.curPhase=phase;																			// Set phase
		this.Draw();																					// Redraw
	}

	DrawCard(num, id, x, y, hgt)																		// DRAW CARD
	{
		let o=this.thens[num];
		let cols=[];
		cols["Structure"]="cyan"; 	cols["Help resource"]="magenta";	
		cols["Options"]="#d4dd46"; 	cols["Chance"]="#ccc";
		let title=o.title.split(" ").join("<br>")

		let str=`<div id="${id}" style="position:absolute;left:${x}px;top:${y}px;width:${hgt*.75}px;height:${hgt}px;
			background-color:#fff;border:2px solid #999;border-radius:6px;
			display:grid;align-items:start;  grid-template-rows: 1fr 2fr 1fr 1fr 3fr 1fr;
			grid-template-areas:'category category category category' 'title title pic time' 
			'subtitle subtitle subtitle subtitle' 'desc desc desc desc''students students students students'">

			<div style="grid-area:category;background-color:${cols[o.category]};font-size:${hgt/12.5}px;text-align:center;
				padding:0 0 2px 0;border-bottom:1px solid #999">${o.category}</div>
			<div style="grid-area:title;padding:8px;color:#999;font-size:${hgt/24}px"><b>${title.replace(/_/g," ")}</b></div>
			<div style="grid-area:subtitle;padding:0 8px;text-align:center;color:#000;font-size:${hgt/24}px"><b>${o.subtitle}</b></div>
			<div style="grid-area:desc;padding:0 12px;font-size:${hgt/24}px">${o.desc}</div>
			<div style="grid-area:time;text-align:right;padding:8px"><img src="img/clock.png" style="width:${hgt/6}px"></div>
			<div style="grid-area:pic;text-align:center;padding-top:8px">`;
			if (o.pic)	str+=`<img src="${o.pic}" style="width:${hgt/6}px">`;
			str+=`</div><div style="grid-area:students;padding-left:12px">`;
			let i,v=o.students.split(",");
			for (i=0;i<v.length;++i)str+=`<span style="display:inline-block;background-color:${this.stuCols[v[i]]};
				margin-right:3px;border-radius:25px;width:${hgt/15}px;height:${hgt/15}px"></span>`
			str+="</div></div>";
		return str;
	}

	DealCards()																						// DEAL CARDS
	{
		let x=0,y=24;
		let h=($(window).height()-300)/2;
		let w=h*.75+12;

		let i,str="";
		str+=this.DrawCard(test++,77,x,y,h);	x+=w;	
		str+=this.DrawCard(test++,77,x,y,h);	x+=w;	
		str+=this.DrawCard(test++,77,x,y,h);	x=0;	y+=h+12;
		str+=this.DrawCard(test++,77,x,y,h);	x+=w;	
		str+=this.DrawCard(test++,77,x,y,h);	x+=w;	
		str+=this.DrawCard(test++,77,x,y,h);	x+=w;	
		
		$("#lz-infieldDiv").html(str.replace(/\t|\n|\r/g,""));										// Add it
	}

	Pick(cards)																						// PICK CARDS
	{
	}

	Vote()																							// VOTE
	{
	}

/////////////////////////////////////////////////////////////////////////////////////////////////
// SOCKET 
/////////////////////////////////////////////////////////////////////////////////////////////////

InitSocketServer()																				// INIT SOCKET SERVER
	{
		if (noNode) {																					// If no nodeJs backend
			this.ws={};																					// Fake socket
			this.ws.send=(msg)=> { this.SocketIn({data:msg});	}										// Send calls socketIn
			return;																						// Quit
			}
		this.secs=0;																					// Time
		this.retryWS=false;																				// Reconnecting to web socket
		if (window.location.host == "localhost") this.ws=new WebSocket('ws://'+window.location.host+':8080');	// Open insecure websocket											
		else									 this.ws=new WebSocket('wss://'+window.location.host+':8080');	// Secure											
		this.ws.onmessage=(e)=>{ this.SocketIn(e); };													// ON INCOMING MESSAGE
		this.ws.onclose=()=>   { console.log('disconnected'); this.ws=null; this.retryWS=true; Sound("delete") };		// ON CLOSE
		this.ws.onerror=(e)=>  { console.log('error',e);	};											// ON ERROR
		this.ws.onopen=()=> { 																			// ON OPEN
			console.log('connected'); 																	// Show connected
			this.ws.send(this.sessionId+"|"+this.activityId+"|"+this.userId+"|INIT");					// Init																	
			this.pollTimer= window.setInterval( ()=>{													// INIT POLLING SERVER
			++this.secs;																				// Another second 
			if (this.retryWS) {																			// If reconnecting to websocket
				if (window.location.host == "localhost") this.ws=new WebSocket('ws://'+window.location.host+':8080');	// Open insecure websocket											
				else									 this.ws=new WebSocket('wss://'+window.location.host+':8080');	// Secure											
				this.ws.onmessage=(e)=>{ this.SocketIn(e); };											// ON INCOMING MESSAGE
				this.ws.onclose=()=>   { this.retryWS=true; console.log('disconnected'); };				// ON CLOSE
				this.ws.onopen=()=>    { console.log('re-connected'); };								// ON OPEN  
				this.retryWS=false;																		// Not retrying	anymore
				}
			},1000)
		}
	}

	SocketIn(event)																					// A WEBSOCKET MESSAGE FROM NODE WS SERVER
	{
		let o;
		if (!event.data)			 return;															// Quit if no data
		let v=event.data.split("|");																	// Get params
		if (v[0] != this.sessionId)	return;																// Quit if wrong session
		if (v[3] == "VIDEO")  	{ if (!$("#lz-videoChat").length) this.VideoChat();	}					// VIDEO
	}

} // CLASS CLOSURE




/////////////////////////////////////////////////////////////////////////////////////////////////
// HELPERS 
/////////////////////////////////////////////////////////////////////////////////////////////////

	function trace(msg, p1, p2, p3, p4)																// CONSOLE 
	{
		if (p4 != undefined)
			console.log(msg,p1,p2,p3,p4);
		else if (p3 != undefined)
			console.log(msg,p1,p2,p3);
		else if (p2 != undefined)
			console.log(msg,p1,p2);
		else if (p1 != undefined)
			console.log(msg,p1);
		else
			console.log(msg);
	}

	function Sound(sound, mute)																		// PLAY SOUND
	{
		var snd=new Audio();																			// Init audio object
		if (sound.match(/\.mp3/i))		snd=new Audio(sound)											// If an MP3 file
		else							snd=new Audio("img/"+sound+".mp3");								// Use built in mp3
		if (!mute)	{																					// If not initing or muting	
			snd.volume=100/100;																			// Set volume
			snd.play();																					// Play it
			}
		}

	function PopUp(msg, time, div)																	// TIMED POPUP
	{
		var str="";
		$("#popupDiv").remove();																		// Kill old one, if any
		str+="<div id='popupDiv' class='lz-popup'>"; 													// Add div
		if (time == -1) {																				// If has close but
			time=100000;																				// Increase time
			str+="<img id='pu-close' src='img/closedot.gif' style='float:right;cursor:pointer'>";		// Add close button
			}
		str+=msg+"</div>"; 																				// Add div
		$(div ? "#"+div : "body").append(str);															// Add popup to div or body
		$("#pu-close").click(function() { $("#popupDiv").remove(); });									// Remove on click of close but
		$("#popupDiv").fadeIn(500).delay(time ? time*1000 : 3000).fadeOut(500);							// Animate in and out		
	}

	function GetTextBox(title, content, def, callback)											// GET TEXT LINE BOX
	{
		trace(123)
		$("#confirmBoxDiv").remove();																	// Remove 
		$("body").append("<div class='lz-confirm' id='confirmBoxDiv'></div>");							// Add box								
		var str="<img src='img/smlogo.png' width='64' style='vertical-align:-8px'/>&nbsp;&nbsp;";								
		str+="<span style='font-size:14px; color:#666'><b>"+title+"</b></span><br><br>";
		str+="<p>"+content+"<p>";
		str+="<p><input class='lz-is' style='width:75%' type='text' id='gtBoxTt' value='"+def+"'></p>";
		str+="<div id='dialogOK' class='lz-bs'>OK</div>";
		str+="<div id='dialogCancel' class='lz-bs' style='margin-left:8px;background-color:#999'>Cancel</div></div>";
		$("#confirmBoxDiv").html(str);																	// Add to div
		$("#gtBoxTt").focus();																			// Focus on button
		$("#gtBoxTt").on("change", function() {	callback($("#gtBoxTt").val()); $("#confirmBoxDiv").remove(); });	// ONE ENTER
		$("#dialogOK").on("click", function() {	callback($("#gtBoxTt").val()); $("#confirmBoxDiv").remove(); });	// ON OK 
		$("#dialogCancel").on("click", function() {	$("#confirmBoxDiv").remove(); });								// ON CANCEL
		}

	function TimecodeToSeconds(timecode) 														// CONVERT TIMECODE TO MILLISECONDS
	{
		if (!timecode)	return 0;
		let t=0;
		let v=timecode.match(/(\d*):(\d*):(\d*)\.*(\d*)/);											// Parse
		t+=v[2]*60*1000;																			// Get mins
		t+=v[3]*1000;																				// Get secs
		if (v[4]) t+=v[4]/1000;																		// Ms
		return t;																					// Return time in ms
	}

	function LoadingIcon(mode)																	// SHOW/HIDE LOADING ICON		
	{
		if (!mode) {																				// If hiding
			$("#lz-loadingIcon").remove();															// Remove it
			return;																					// Quit
			}
		let str="<div id='lz-loadingIcon' style='position:absolute;top:calc(50% - 64px);left:calc(50% - 64px);z-index:5000;text-align:center'>";
		str+="<img src='img/loading.gif' width='128'>";												// Img
		str+="<div id='lz-loadingIconText' style='margin-top:-78px;color:#999'></div></div>";		// Progress
		$("body").append(str);																		// Add icon to container
	}

</script>
</body>
</html>



